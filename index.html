<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Puzzle Stik - Mobile</title>
<style>
  :root{ --border:#e5e5e5; }
  body{ margin:0; font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif; background:#fff; color:#111; }
  .wrap{ max-width:100vw; padding:12px 10px; }          /* full width, no centering */
  .topbar{ display:flex; justify-content:flex-start; gap:10px; align-items:center; }
  button{ padding:.55rem .9rem; border:2px solid #333; border-radius:8px; background:#eee; font-weight:600; cursor:pointer; }
  #reset{ background:#f1f1f1; }
  canvas{
    display:block;
    width:100%;              /* responsive: isi lebar layar */
    max-width:700px;         /* jangan lebih dari resolusi internal */
    height:auto;             /* pertahankan rasio */
    border:1px solid var(--border);
    border-radius:10px;
    margin:12px 0 18px 0;    /* menempel kiri */
    touch-action:none;       /* penting untuk drag di HP */
    -webkit-user-select:none; user-select:none;
  }
  .hint{ color:#666; font-size:.9rem; }
</style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <button id="reset">ðŸ”„ Reset</button>
    </div>
    <canvas id="board" width="700" height="700"></canvas>
    <div class="hint">Tip: ketuk lalu seret stik untuk memindahkan. Tekan Reset untuk kembali ke posisi awal.</div>
  </div>

<script>
/* ====== Konstanta & util ====== */
const WIDTH=700, HEIGHT=700, BLACK="#000", RED="#f00", LINE_W=5;

class Vec{ constructor(x=0,y=0){this.x=x;this.y=y} copy(){return new Vec(this.x,this.y)} }
class Stick{
  constructor(x1,y1,x2,y2){
    this.initialStart=new Vec(x1,y1); this.initialEnd=new Vec(x2,y2);
    this.start=this.initialStart.copy(); this.end=this.initialEnd.copy();
    this.selected=false;
  }
  draw(ctx){
    ctx.strokeStyle=this.selected?RED:BLACK; ctx.lineWidth=LINE_W; ctx.lineCap="round";
    ctx.beginPath(); ctx.moveTo(this.start.x,this.start.y); ctx.lineTo(this.end.x,this.end.y); ctx.stroke();
  }
  isClicked(pos){
    const midx=(this.start.x+this.end.x)/2, midy=(this.start.y+this.end.y)/2;
    return Math.hypot(pos.x-midx,pos.y-midy) < 30;
  }
  move(dx,dy){ this.start.x+=dx; this.start.y+=dy; this.end.x+=dx; this.end.y+=dy; }
  reset(){ this.start=this.initialStart.copy(); this.end=this.initialEnd.copy(); }
}

function addSegment(set,x1,y1,x2,y2){
  const key=(x1<x2 || (x1===x2 && y1<=y2)) ? `${x1},${y1},${x2},${y2}` : `${x2},${y2},${x1},${y1}`;
  set.add(key);
}
function addSquare(set,x,y,size){
  addSegment(set,x,y,x+size,y);
  addSegment(set,x+size,y,x+size,y+size);
  addSegment(set,x+size,y+size,x,y+size);
  addSegment(set,x,y+size,x,y);
}

/* ====== Layout: mepet kiri ======
   - 3 kotak bawah saling menempel
   - 2 kotak menumpuk di kanan
   - start dari base_x=10 agar mepet kiri */
function generateSticks(){
  const size=80;
  const base_x=10;              // << mepet kiri
  const base_y=110;             // di bawah tombol
  const uniq=new Set();

  for(let i=0;i<3;i++) addSquare(uniq, base_x + i*size, base_y + 2*size, size);
  const right_x = base_x + 2*size;
  addSquare(uniq, right_x, base_y + size, size);
  addSquare(uniq, right_x, base_y, size);

  const arr=[];
  uniq.forEach(k=>{
    const [x1,y1,x2,y2]=k.split(',').map(Number);
    arr.push(new Stick(x1,y1,x2,y2));
  });
  return arr; // total 16 stik
}

const canvas=document.getElementById("board");
const ctx=canvas.getContext("2d");
const sticks=generateSticks();

let selected=null, offset={x:0,y:0};

/* Koordinat pointer yang sudah dikoreksi skala CSS (supaya tidak ngaco saat canvas diperkecil di HP) */
function getPos(e){
  const r=canvas.getBoundingClientRect();
  const scaleX = canvas.width / r.width;   // 700 / lebar CSS
  const scaleY = canvas.height / r.height; // 700 / tinggi CSS
  return { x:(e.clientX - r.left) * scaleX, y:(e.clientY - r.top) * scaleY };
}

/* ====== Pointer Events (mouse & touch) ====== */
canvas.addEventListener("pointerdown",(e)=>{
  const pos=getPos(e);
  for(let i=sticks.length-1;i>=0;i--){
    const s=sticks[i];
    if(s.isClicked(pos)){
      selected=s; s.selected=true;
      offset.x=pos.x - s.start.x; offset.y=pos.y - s.start.y;
      canvas.setPointerCapture(e.pointerId);
      e.preventDefault();
      break;
    }
  }
});
canvas.addEventListener("pointermove",(e)=>{
  if(!selected) return;
  const pos=getPos(e);
  const newX=pos.x - offset.x, newY=pos.y - offset.y;
  const dx=newX - selected.start.x, dy=newY - selected.start.y;
  selected.move(dx,dy);
  e.preventDefault();
});
function endDrag(e){
  if(selected){ selected.selected=false; selected=null; }
  try{ canvas.releasePointerCapture(e.pointerId); }catch(_){}
}
canvas.addEventListener("pointerup", endDrag);
canvas.addEventListener("pointercancel", endDrag);
canvas.addEventListener("pointerleave", endDrag);

/* ====== Reset ====== */
document.getElementById("reset").addEventListener("click", ()=> sticks.forEach(s=>s.reset()) );

/* ====== Render ====== */
function draw(){
  ctx.clearRect(0,0,WIDTH,HEIGHT);
  ctx.fillStyle="#000"; ctx.font="18px system-ui,Segoe UI,Roboto,Arial";
  ctx.fillText("Puzzle Stik - seret untuk memindahkan", 12, 36);
  sticks.forEach(s=> s.draw(ctx));
  requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
