<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Puzzle Stik - 5 Kotak (Mobile Left)</title>
<style>
  html, body { margin:0; max-width:100%; overflow-x:hidden; background:#fff; }
  body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{width:100%; margin:0; padding:12px 12px 24px 0} /* padding-left=0 -> mepet kiri */
  .topbar{display:flex; justify-content:flex-end; gap:10px; align-items:center}
  button{padding:.55rem .9rem; border:2px solid #333; border-radius:8px; background:#eee; font-weight:600; cursor:pointer}
  #reset{background:#f1f1f1}
  canvas{
    display:block; margin:12px 0 24px 0; border:1px solid #e5e5e5; border-radius:10px;
    width:100%; height:auto;          /* responsive width (CSS) */
    touch-action:none; user-select:none; -webkit-user-select:none; /* penting untuk drag di HP */
    background:#fff;
  }
  .hint{color:#666;font-size:.9rem;margin-left:0}
</style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <button id="reset">ðŸ”„ Reset</button>
  </div>
  <!-- width/height akan diatur via JS sesuai DPR -->
  <canvas id="board"></canvas>
  <div class="hint">Tip: ketuk stik (merah saat terpilih), lalu seret untuk memindahkan. Tidak perlu scroll ke kananâ€”kanvas responsif & menempel kiri.</div>
</div>

<script>
/* ====== Model koordinat logis berbasis 700x700, lalu di-scale ke layar ====== */
const BASE = 700; // ukuran logis
const BLACK = "#000000", RED = "#ff0000", LINE_W = 5;

class Vec{ constructor(x=0,y=0){this.x=x;this.y=y} copy(){return new Vec(this.x,this.y)} }
class Stick{
  constructor(x1,y1,x2,y2){
    this.initialStart=new Vec(x1,y1); this.initialEnd=new Vec(x2,y2);
    this.start=this.initialStart.copy(); this.end=this.initialEnd.copy();
    this.selected=false;
  }
  draw(ctx){
    ctx.strokeStyle=this.selected?RED:BLACK;
    ctx.lineWidth=LINE_W;
    ctx.lineCap="round";
    ctx.beginPath();
    ctx.moveTo(this.start.x, this.start.y);
    ctx.lineTo(this.end.x, this.end.y);
    ctx.stroke();
  }
  isClicked(pos){ // cek dekat tengah stik
    const mx=(this.start.x+this.end.x)/2, my=(this.start.y+this.end.y)/2;
    return Math.hypot(pos.x-mx, pos.y-my) < 30;
  }
  move(dx,dy){ this.start.x+=dx; this.start.y+=dy; this.end.x+=dx; this.end.y+=dy; }
  reset(){ this.start=this.initialStart.copy(); this.end=this.initialEnd.copy(); }
}

/* --------- util bentuk unik --------- */
function addSegment(set,x1,y1,x2,y2){
  const key=(x1<x2 || (x1===x2 && y1<=y2)) ? `${x1},${y1},${x2},${y2}` : `${x2},${y2},${x1},${y1}`;
  set.add(key);
}
function addSquare(set,x,y,size){
  addSegment(set,x, y, x+size, y);             // atas
  addSegment(set,x+size, y, x+size, y+size);   // kanan
  addSegment(set,x+size, y+size, x, y+size);   // bawah
  addSegment(set,x, y+size, x, y);             // kiri
}

/* --------- layout: 3 kotak bawah menempel, 2 kotak menumpuk di kanan; mepet ke KIRI --------- */
function generateSticks(){
  const size=80;
  const base_x = 0;       // MELET di kiri (bukan center)
  const base_y = 120;     // pos vertikal di bawah tombol
  const uniq=new Set();

  // 3 kotak bawah (menempel)
  for(let i=0;i<3;i++) addSquare(uniq, base_x + i*size, base_y + 2*size, size);

  // 2 kotak menumpuk di kanan
  const right_x = base_x + 2*size;
  addSquare(uniq, right_x, base_y + size, size);
  addSquare(uniq, right_x, base_y, size);

  const sticks=[];
  uniq.forEach(k=>{
    const [x1,y1,x2,y2]=k.split(',').map(Number);
    sticks.push(new Stick(x1,y1,x2,y2));
  });
  return sticks; // total 16 stik
}

/* ====== Inisialisasi kanvas responsif ====== */
const canvas = document.getElementById('board');
const ctx = canvas.getContext('2d');
let scale = 1;     // skala dari koordinat logis -> CSS pixels
let dpr = 1;       // devicePixelRatio
const sticks = generateSticks();

function resizeCanvas(){
  // Lebar CSS kanvas = lebar kontainer (tanpa overflow)
  const cssWidth = Math.min(document.documentElement.clientWidth, 700); // â‰¤700 agar proporsi tetap
  const cssHeight = cssWidth; // square

  // Set ukuran CSS (visual) â€” ini yang mempengaruhi layout & scroll
  canvas.style.width = cssWidth + 'px';
  canvas.style.height = cssHeight + 'px';

  // Siapkan buffer piksel sesuai DPR agar tajam
  dpr = window.devicePixelRatio || 1;
  canvas.width = Math.round(cssWidth * dpr);
  canvas.height = Math.round(cssHeight * dpr);

  // Skala dari koordinat logis BASE -> CSS width
  scale = cssWidth / BASE;

  // Set transform untuk semua gambar (DPR * SCALE)
  ctx.setTransform(dpr*scale, 0, 0, dpr*scale, 0, 0);
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

/* ====== Input & Drag (Pointer Events) ====== */
let selected = null;
let offset = {x:0, y:0};

function getLogicalPos(evt){
  const rect = canvas.getBoundingClientRect();
  // koordinat logis (bukan CSS pixel)
  return {
    x: (evt.clientX - rect.left) / scale,
    y: (evt.clientY - rect.top) / scale
  };
}
canvas.addEventListener('pointerdown', (e)=>{
  const pos = getLogicalPos(e);
  for(let i=sticks.length-1;i>=0;i--){
    const s = sticks[i];
    if(s.isClicked(pos)){
      selected = s; s.selected = true;
      offset.x = pos.x - s.start.x;
      offset.y = pos.y - s.start.y;
      canvas.setPointerCapture(e.pointerId);
      e.preventDefault();
      break;
    }
  }
});
canvas.addEventListener('pointermove', (e)=>{
  if(!selected) return;
  const pos = getLogicalPos(e);
  const newX = pos.x - offset.x, newY = pos.y - offset.y;
  const dx = newX - selected.start.x, dy = newY - selected.start.y;
  selected.move(dx, dy);
  e.preventDefault();
});
function endDrag(e){
  if(selected){ selected.selected=false; selected=null; }
  try{ canvas.releasePointerCapture(e.pointerId); }catch(_){}
}
canvas.addEventListener('pointerup', endDrag);
canvas.addEventListener('pointercancel', endDrag);
canvas.addEventListener('pointerleave', endDrag);

/* ====== Reset ====== */
document.getElementById('reset').addEventListener('click', ()=> sticks.forEach(s=> s.reset()) );

/* ====== Render loop ====== */
function draw(){
  // bersihkan dengan transform aktif (pakai koordinat logis)
  ctx.save();
  ctx.setTransform(dpr*scale,0,0,dpr*scale,0,0);
  ctx.clearRect(0,0,BASE,BASE);

  // judul
  ctx.fillStyle = "#000";
  ctx.font = "20px system-ui,Segoe UI,Roboto,Arial";
  ctx.fillText("Puzzle Stik - 5 Kotak (drag di HP, mepet kiri)", 10, 32);

  // stik
  sticks.forEach(s=> s.draw(ctx));

  ctx.restore();
  requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
